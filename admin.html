<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²€ ê°•í™” ê²Œì„ Admin - í†µí•© ê´€ë¦¬</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; margin: 0; padding-top: 80px; display: none; }
        .header { position: fixed; top: 0; width: 100%; background: #2c3e50; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-sizing: border-box; }
        .save-btn { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .container { max-width: 1200px; margin: auto; padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #ddd; overflow-x: auto; }
        .user-row { display: grid; grid-template-columns: 120px 100px 1fr 80px 100px 80px; gap: 10px; align-items: center; padding: 10px; border-bottom: 1px solid #eee; min-width: 800px; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 100%; box-sizing: border-box; }
        .btn-ban { background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-unban { background: #3498db; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-update { background: #95a5a6; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>
    <div class="header">
        <h3 style="margin:0;">ê²€ ê°•í™” ê²Œì„ Admin (codetbase)</h3>
        <button class="save-btn" onclick="saveAllSettings()">ìƒë‹¨ ì„¤ì • ì €ì¥ (ì•„ì´í…œ/ì½”ë“œ)</button>
    </div>

    <div class="container">
        <h3>ğŸ‘¥ íšŒì› ê´€ë¦¬ (ì •ì§€ ë° ì •ë³´ ìˆ˜ì •ì€ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤)</h3>
        <div class="card" id="user-list"></div>

        </div>

<script>
    const SUPABASE_URL = 'https://utfrjzcnefsbuadnkdud.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0ZnJqemNuZWZzYnVhZG5rZHVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4MjE1MTYsImV4cCI6MjA4MjM5NzUxNn0.D3Za1nMw-x0JwOpkFuYceUHlagcpRdrpFqNUIP5Kjdc';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function load() {
        const { data: u } = await supabaseClient.from('profiles').select('*').order('nickname', { ascending: true });
        userData = u || [];
        renderUsers();
    }

    function renderUsers() {
        const uBox = document.getElementById('user-list');
        uBox.innerHTML = `<div class="user-row" style="font-weight:bold; background:#f8f9fa;">
            <div>ë‹‰ë„¤ì„</div><div>ê³¨ë“œ</div><div>ì •ì§€ ì‚¬ìœ </div><div>ìƒíƒœ</div><div>ì •ì§€ ì‘ì—…</div><div>ì •ë³´ ìˆ˜ì •</div>
        </div>`;
        
        userData.forEach((user) => {
            const isBanned = user.is_banned === true;
            const div = document.createElement('div');
            div.className = 'user-row';
            div.innerHTML = `
                <input type="text" id="nick-${user.id}" value="${user.nickname || ''}">
                <input type="number" id="gold-${user.id}" value="${user.gold || 0}">
                <input type="text" id="reason-${user.id}" placeholder="ì‚¬ìœ  ì…ë ¥" value="${user.ban_reason || ''}">
                <div style="color:${isBanned?'red':'green'}; font-weight:bold; text-align:center;">${isBanned?'ì •ì§€':'ì •ìƒ'}</div>
                <button class="${isBanned?'btn-unban':'btn-ban'}" onclick="updateBanStatus('${user.id}', ${!isBanned})">
                    ${isBanned?'í•´ì œí•˜ê¸°':'ì •ì§€í•˜ê¸°'}
                </button>
                <button class="btn-update" onclick="updateUserInfo('${user.id}')">ìˆ˜ì •</button>
            `;
            uBox.appendChild(div);
        });
    }

    // [ì¤‘ìš”] ì •ì§€ ìƒíƒœ ì¦‰ì‹œ DB ì €ì¥ (í’€ë¦´ ì¼ ì—†ìŒ)
    async function updateBanStatus(userId, status) {
        const reason = document.getElementById(`reason-${userId}`).value;
        if(status && !reason) return alert("ì •ì§€ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const { error } = await supabaseClient
            .from('profiles')
            .update({ is_banned: status, ban_reason: status ? reason : "" })
            .eq('id', userId);

        if(!error) {
            alert(status ? "ê³„ì •ì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤." : "ì •ì§€ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            load();
        } else {
            alert("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: " + error.message);
        }
    }

    // [ì¤‘ìš”] ë‹‰ë„¤ì„, ê³¨ë“œ ì •ë³´ ê°œë³„ ìˆ˜ì • (ì¦‰ì‹œ ë°˜ì˜)
    async function updateUserInfo(userId) {
        const nick = document.getElementById(`nick-${userId}`).value;
        const gold = document.getElementById(`gold-${userId}`).value;
        const reason = document.getElementById(`reason-${userId}`).value;

        const { error } = await supabaseClient
            .from('profiles')
            .update({ nickname: nick, gold: Number(gold), ban_reason: reason })
            .eq('id', userId);

        if(!error) {
            alert("ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            load();
        } else {
            alert("ìˆ˜ì • ì‹¤íŒ¨: " + error.message);
        }
    }

    // ìƒë‹¨ ë²„íŠ¼ì€ ì•„ì´í…œê³¼ ì½”ë“œë§Œ ì €ì¥í•˜ë„ë¡ ë¶„ë¦¬
    async function saveAllSettings() {
        // ê¸°ì¡´ swordData, rewardCodes ì €ì¥ ë¡œì§ ì‹¤í–‰...
        alert("ì•„ì´í…œ ë° ì½”ë“œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // ë¹„ë°€ë²ˆí˜¸ ì²´í¬ ë° ì´ˆê¸°í™”
    function init() {
        const pw = prompt("ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
        if(pw === "1234") {
            document.body.style.display = "block";
            load();
        } else {
            alert("í‹€ë ¸ìŠµë‹ˆë‹¤.");
            window.location.reload();
        }
    }
    init();
</script>
</body>
</html>
